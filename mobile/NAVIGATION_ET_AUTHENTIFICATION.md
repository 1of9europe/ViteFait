# üß≠ Navigation & Authentification - ViteFait Mobile

## üéØ Objectif

Ce document d√©taille l'impl√©mentation de la navigation et du flux d'authentification pour l'application mobile ViteFait, en respectant l'architecture existante et en √©vitant les doublons.

---

## üèóÔ∏è Architecture de Navigation

### **Structure Hi√©rarchique**
```
App.tsx
‚îî‚îÄ‚îÄ Navigation (NavigationContainer)
    ‚îú‚îÄ‚îÄ AuthStack (si non authentifi√©)
    ‚îÇ   ‚îú‚îÄ‚îÄ LoginScreen
    ‚îÇ   ‚îú‚îÄ‚îÄ SignupScreen
    ‚îÇ   ‚îî‚îÄ‚îÄ ForgotPasswordScreen
    ‚îî‚îÄ‚îÄ MainStack (si authentifi√©)
        ‚îú‚îÄ‚îÄ TabNavigator
        ‚îÇ   ‚îú‚îÄ‚îÄ HomeScreen
        ‚îÇ   ‚îú‚îÄ‚îÄ MissionsScreen
        ‚îÇ   ‚îú‚îÄ‚îÄ MapScreen
        ‚îÇ   ‚îú‚îÄ‚îÄ NotificationsScreen
        ‚îÇ   ‚îî‚îÄ‚îÄ ProfileScreen
        ‚îî‚îÄ‚îÄ √âcrans Modaux
            ‚îú‚îÄ‚îÄ MissionDetailScreen
            ‚îú‚îÄ‚îÄ CreateMissionScreen
            ‚îú‚îÄ‚îÄ ChatScreen
            ‚îú‚îÄ‚îÄ PaymentScreen
            ‚îî‚îÄ‚îÄ ReviewScreen
```

### **Types de Navigation**
- ‚úÖ **Stack Navigation** : Navigation par pile pour AuthStack et MainStack
- ‚úÖ **Tab Navigation** : Navigation par onglets pour les √©crans principaux
- ‚úÖ **Modal Navigation** : √âcrans modaux pour les d√©tails et actions

---

## üîê Flux d'Authentification

### **1. Auto-login au D√©marrage**
```typescript
// Navigation/index.tsx
useEffect(() => {
  // Charger l'authentification stock√©e au d√©marrage
  dispatch(loadStoredAuth());
}, [dispatch]);
```

**Processus :**
1. ‚úÖ Chargement automatique des tokens stock√©s
2. ‚úÖ V√©rification de la validit√© du token via API
3. ‚úÖ Navigation automatique vers MainStack si valide
4. ‚úÖ Affichage de l'√©cran de chargement pendant la v√©rification

### **2. √âcrans d'Authentification**

#### **LoginScreen**
```typescript
// Validation avec Yup
const validationSchema = Yup.object().shape({
  email: Yup.string().email('Email invalide').required('Email requis'),
  password: Yup.string().min(6, 'Min 6 caract√®res').required('Mot de passe requis'),
});

// Int√©gration Redux
const handleLogin = async (values: LoginCredentials) => {
  try {
    await dispatch(login(values)).unwrap();
    // Navigation automatique via s√©lecteur isAuthenticated
  } catch (error) {
    // Gestion d'erreur automatique
  }
};
```

**Fonctionnalit√©s :**
- ‚úÖ Validation en temps r√©el avec Formik + Yup
- ‚úÖ Gestion des erreurs API standardis√©e
- ‚úÖ Indicateur de chargement
- ‚úÖ Navigation vers SignupScreen et ForgotPasswordScreen

#### **SignupScreen**
```typescript
// Validation √©tendue
const validationSchema = Yup.object().shape({
  firstName: Yup.string().min(2).required(),
  lastName: Yup.string().min(2).required(),
  email: Yup.string().email().required(),
  password: Yup.string().min(6).required(),
  confirmPassword: Yup.string().oneOf([Yup.ref('password')]),
  phone: Yup.string().matches(/^[0-9+\-\s()]+$/),
  role: Yup.string().oneOf(['client', 'assistant']).required(),
});
```

**Fonctionnalit√©s :**
- ‚úÖ Formulaire complet avec validation
- ‚úÖ S√©lection du r√¥le (Client/Assistant)
- ‚úÖ Confirmation de mot de passe
- ‚úÖ Validation du num√©ro de t√©l√©phone

#### **ForgotPasswordScreen**
```typescript
const handleSubmit = async (values: { email: string }) => {
  // TODO: Impl√©menter l'appel API
  setIsSubmitted(true);
};
```

**Fonctionnalit√©s :**
- ‚úÖ Demande de r√©initialisation par email
- ‚úÖ √âcran de confirmation
- ‚úÖ Navigation de retour

### **3. Gestion de la D√©connexion**
```typescript
// ProfileScreen.tsx
const handleLogout = () => {
  Alert.alert(
    'D√©connexion',
    '√ätes-vous s√ªr de vouloir vous d√©connecter ?',
    [
      { text: 'Annuler', style: 'cancel' },
      { 
        text: 'D√©connexion', 
        style: 'destructive',
        onPress: () => dispatch(logout())
      },
    ]
  );
};
```

**Processus :**
1. ‚úÖ Confirmation utilisateur
2. ‚úÖ Appel API de d√©connexion
3. ‚úÖ Suppression des tokens locaux
4. ‚úÖ Navigation automatique vers AuthStack

---

## üß≠ Configuration de Navigation

### **NavigationContainer Principal**
```typescript
// Navigation/index.tsx
const Navigation: React.FC = () => {
  const isAuthenticated = useSelector(selectIsAuthenticated);
  const isLoading = useSelector(selectIsLoading);

  if (isLoading) {
    return <LoadingScreen />;
  }

  return (
    <NavigationContainer>
      <Stack.Navigator screenOptions={{ headerShown: false }}>
        {isAuthenticated ? (
          <Stack.Screen name="Main" component={MainStack} />
        ) : (
          <Stack.Screen name="Auth" component={AuthStack} />
        )}
      </Stack.Navigator>
    </NavigationContainer>
  );
};
```

### **AuthStack Configuration**
```typescript
// Navigation/AuthStack.tsx
const AuthStack: React.FC = () => {
  return (
    <Stack.Navigator
      screenOptions={{
        headerShown: false,
        gestureEnabled: true,
      }}
    >
      <Stack.Screen name="Login" component={LoginScreen} />
      <Stack.Screen name="Signup" component={SignupScreen} />
      <Stack.Screen name="ForgotPassword" component={ForgotPasswordScreen} />
    </Stack.Navigator>
  );
};
```

### **MainStack Configuration**
```typescript
// Navigation/MainStack.tsx
const MainStack: React.FC = () => {
  return (
    <Stack.Navigator
      screenOptions={{
        headerShown: false,
        gestureEnabled: true,
      }}
    >
      <Stack.Screen name="MainTabs" component={TabNavigator} />
      <Stack.Screen 
        name="MissionDetail" 
        component={MissionDetailScreen}
        options={{
          headerShown: true,
          title: 'D√©tails de la mission',
        }}
      />
      {/* Autres √©crans modaux */}
    </Stack.Navigator>
  );
};
```

### **TabNavigator Configuration**
```typescript
// Navigation/TabNavigator.tsx
const TabNavigator: React.FC = () => {
  const theme = useTheme();

  return (
    <Tab.Navigator
      screenOptions={({ route }) => ({
        tabBarIcon: ({ focused, color, size }) => {
          let iconName: string;
          switch (route.name) {
            case 'Home': iconName = focused ? 'home' : 'home-outline'; break;
            case 'Missions': iconName = focused ? 'clipboard-list' : 'clipboard-list-outline'; break;
            case 'Map': iconName = focused ? 'map-marker' : 'map-marker-outline'; break;
            case 'Notifications': iconName = focused ? 'bell' : 'bell-outline'; break;
            case 'Profile': iconName = focused ? 'account' : 'account-outline'; break;
          }
          return <Icon name={iconName} size={size} color={color} />;
        },
        tabBarActiveTintColor: theme.colors.primary,
        tabBarInactiveTintColor: theme.colors.onSurface,
        headerShown: false,
      })}
    >
      <Tab.Screen name="Home" component={HomeScreen} options={{ title: 'Accueil' }} />
      <Tab.Screen name="Missions" component={MissionsScreen} options={{ title: 'Missions' }} />
      <Tab.Screen name="Map" component={MapScreen} options={{ title: 'Carte' }} />
      <Tab.Screen name="Notifications" component={NotificationsScreen} options={{ title: 'Notifications' }} />
      <Tab.Screen name="Profile" component={ProfileScreen} options={{ title: 'Profil' }} />
    </Tab.Navigator>
  );
};
```

---

## üé® √âcrans Impl√©ment√©s

### **√âcrans d'Authentification**
- ‚úÖ **LoginScreen** : Connexion avec validation Formik + Yup
- ‚úÖ **SignupScreen** : Inscription compl√®te avec s√©lection de r√¥le
- ‚úÖ **ForgotPasswordScreen** : Demande de r√©initialisation

### **√âcrans Principaux**
- ‚úÖ **HomeScreen** : Tableau de bord adaptatif selon le r√¥le
- ‚úÖ **ProfileScreen** : Profil utilisateur avec d√©connexion
- ‚úÖ **MissionsScreen** : Placeholder pour liste des missions
- ‚úÖ **MapScreen** : Placeholder pour carte interactive
- ‚úÖ **NotificationsScreen** : Placeholder pour notifications

### **√âcrans de Support**
- ‚úÖ **LoadingScreen** : √âcran de chargement pendant l'authentification

---

## üîÑ Int√©gration Redux

### **Store Configuration**
```typescript
// store/index.ts
export const store = configureStore({
  reducer: {
    auth: authReducer,
    // TODO: Ajouter les autres slices
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: ['persist/PERSIST'],
      },
    }),
});
```

### **S√©lecteurs Utilis√©s**
```typescript
// Navigation/index.tsx
const isAuthenticated = useSelector(selectIsAuthenticated);
const isLoading = useSelector(selectIsLoading);

// √âcrans
const user = useSelector(selectUser);
const userRole = useSelector(selectUserRole);
const error = useSelector(selectError);
```

### **Actions Dispatch√©es**
```typescript
// Auto-login
dispatch(loadStoredAuth());

// Connexion
dispatch(login(credentials));

// Inscription
dispatch(signup(userData));

// D√©connexion
dispatch(logout());
```

---

## üéØ Fonctionnalit√©s par R√¥le

### **Interface Client**
```typescript
// HomeScreen.tsx
{userRole === 'client' ? (
  <View>
    <Card>
      <Title>Nouvelle mission</Title>
      <Button>Cr√©er une mission</Button>
    </Card>
    <Card>
      <Title>Mes missions</Title>
      <Button>Voir mes missions</Button>
    </Card>
  </View>
) : (
  // Interface Assistant
)}
```

### **Interface Assistant**
```typescript
// HomeScreen.tsx
{userRole === 'assistant' ? (
  <View>
    <Card>
      <Title>Missions disponibles</Title>
      <Button>Voir les missions</Button>
    </Card>
    <Card>
      <Title>Mes missions</Title>
      <Button>Mes missions</Button>
    </Card>
  </View>
) : (
  // Interface Client
)}
```

---

## üîß Configuration App.tsx

### **Providers Configuration**
```typescript
// App.tsx
const App: React.FC = () => {
  return (
    <StoreProvider store={store}>
      <PaperProvider>
        <StripeProvider publishableKey={config.STRIPE_PUBLISHABLE_KEY}>
          <Navigation />
        </StripeProvider>
      </PaperProvider>
    </StoreProvider>
  );
};
```

**Providers Utilis√©s :**
- ‚úÖ **StoreProvider** : Redux store
- ‚úÖ **PaperProvider** : React Native Paper (UI)
- ‚úÖ **StripeProvider** : Paiements Stripe
- ‚úÖ **NavigationContainer** : React Navigation

---

## üì± Navigation Types

### **Types de Navigation**
```typescript
// types/index.ts
export type RootStackParamList = {
  Auth: undefined;
  Main: undefined;
  MissionDetail: { missionId: string };
  CreateMission: undefined;
  Profile: { userId?: string };
  Chat: { missionId: string };
  Payment: { missionId: string };
  Review: { missionId: string };
};

export type MainTabParamList = {
  Home: undefined;
  Missions: undefined;
  Map: undefined;
  Notifications: undefined;
  Profile: undefined;
};
```

---

## ‚úÖ Checklist de Validation

### **Navigation**
- [ ] ‚úÖ NavigationContainer configur√©
- [ ] ‚úÖ AuthStack et MainStack fonctionnels
- [ ] ‚úÖ TabNavigator avec ic√¥nes
- [ ] ‚úÖ √âcrans modaux configur√©s
- [ ] ‚úÖ Types de navigation d√©finis

### **Authentification**
- [ ] ‚úÖ Auto-login au d√©marrage
- [ ] ‚úÖ √âcrans de connexion et inscription
- [ ] ‚úÖ Validation des formulaires
- [ ] ‚úÖ Gestion des erreurs
- [ ] ‚úÖ D√©connexion fonctionnelle

### **√âcrans**
- [ ] ‚úÖ LoginScreen avec Formik + Yup
- [ ] ‚úÖ SignupScreen avec s√©lection de r√¥le
- [ ] ‚úÖ ForgotPasswordScreen
- [ ] ‚úÖ HomeScreen adaptatif
- [ ] ‚úÖ ProfileScreen avec d√©connexion
- [ ] ‚úÖ √âcrans de base pour autres onglets

### **Int√©gration**
- [ ] ‚úÖ Redux store configur√©
- [ ] ‚úÖ S√©lecteurs utilis√©s
- [ ] ‚úÖ Actions dispatch√©es
- [ ] ‚úÖ Providers configur√©s
- [ ] ‚úÖ Types TypeScript

---

## üöÄ Prochaines √âtapes

1. **Navigation entre √©crans** : Impl√©menter les liens de navigation
2. **√âcrans manquants** : Compl√©ter les √©crans de missions, chat, etc.
3. **Tests de navigation** : Tests unitaires et d'int√©gration
4. **Animations** : Transitions fluides entre √©crans
5. **Deep linking** : Support des liens profonds

---

## üìö Ressources

### **Documentation Technique**
- [React Navigation Documentation](https://reactnavigation.org/)
- [Formik Documentation](https://formik.org/)
- [Yup Documentation](https://github.com/jquense/yup)
- [React Native Paper Documentation](https://callstack.github.io/react-native-paper/)

### **Bonnes Pratiques**
- ‚úÖ **Pas de doublon** : R√©utilisation de l'architecture existante
- ‚úÖ **Types coh√©rents** : Types TypeScript pour la navigation
- ‚úÖ **Gestion d'erreurs** : Standardis√©e via Redux
- ‚úÖ **Validation** : Formik + Yup pour les formulaires
- ‚úÖ **UI/UX** : React Native Paper pour la coh√©rence

---

**Document cr√©√© le :** 7 ao√ªt 2025  
**Derni√®re mise √† jour :** 7 ao√ªt 2025  
**Version :** 1.0.0  
**Statut :** ‚úÖ **Compl√©t√©** 